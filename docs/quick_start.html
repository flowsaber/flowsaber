

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quick Start &mdash; context 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/mystnb.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Task" href="task.html" />
    <link rel="prev" title="Welcome to flowsaber’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> context
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main-concepts">Main concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#task">Task</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flow">Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#channel">Channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operator">Operator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#a-typical-workflow">A Typical workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-for-real-work">Example for real work</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="task.html">Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executor</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Internal</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">context</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quick Start</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quick_start.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quick-start">
<h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Install from PYPI or from source.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">flowsaber</span>
</pre></div>
</div>
<p>Or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>https://github.com/zhqu1148980644/flowsaber.git
<span class="nb">cd</span> flowsaber <span class="o">&amp;&amp;</span> pip install .
</pre></div>
</div>
</div>
<div class="section" id="main-concepts">
<h2>Main concepts<a class="headerlink" href="#main-concepts" title="Permalink to this headline">¶</a></h2>
<p>For users who are familiar with nextflow usages can skip this part, other’s can also check
<a class="reference external" href="https://www.nextflow.io/docs/edge/basic.html">this</a> for similar descriptions that comes from the introduction
section of the nextflow documentation.</p>
<p>Basically there are several components that are exposed to users for building and configuring workflows.</p>
<div class="section" id="task">
<h3>Task<a class="headerlink" href="#task" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Task</span></code> is the object represents the execution unit in your workflow. Tasks runs in parallel for different inputs.</p>
</div>
<div class="section" id="flow">
<h3>Flow<a class="headerlink" href="#flow" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Flow</span></code> is the object that combines and records dependencies of all tasks you have put in. After it’s been
instantiated, it should be called for the actual dependency building and then can be executed by call <code class="docutils literal notranslate"><span class="pre">flow.execute()</span></code>.</p>
</div>
<div class="section" id="channel">
<h3>Channel<a class="headerlink" href="#channel" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Channel</span></code> represents a flow/queue of data, it’s consumed by Tasks. Any user defined data should be
enqueued into a channel and then as arguments of Task/Flow.</p>
</div>
<div class="section" id="operator">
<h3>Operator<a class="headerlink" href="#operator" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Operator</span></code> is built-in tasks that helps to manipulate the control of channels.</p>
<ul class="simple">
<li><p>For example: <code class="docutils literal notranslate"><span class="pre">map,</span> <span class="pre">sum,</span> <span class="pre">count,</span> <span class="pre">collect,</span> <span class="pre">flatten....</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="a-typical-workflow">
<h2>A Typical workflow<a class="headerlink" href="#a-typical-workflow" title="Permalink to this headline">¶</a></h2>
<p>The workflow defined below covers most sets of features supported by pyflow.</p>
<ul class="simple">
<li><p>Note: the output of the workflow may be different in different runs, this is
due to the parallelism of task’s executions for different inputs.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;../../&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">flowsaber</span>
<span class="kn">from</span> <span class="nn">flowsaber</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">EnvTask</span><span class="o">.</span><span class="n">DEFAULT_CONFIG</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task_workdir&#39;</span><span class="p">:</span> <span class="s1">&#39;/tmp/Env&#39;</span><span class="p">}</span>  <span class="c1"># make the EnvTask cache at a global place</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>  <span class="c1"># self is optional</span>
    <span class="k">return</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num1</span> <span class="o">*</span> <span class="n">num2</span>

<span class="nd">@shell</span>
<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;echo {num} &gt; 1.txt&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;*.txt&#39;</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">File</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">sub_flow</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">|</span> <span class="n">map_</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">add</span>

<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">my_flow</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="p">[</span><span class="n">sub_flow</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">sub_flow</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span> <span class="o">|</span> <span class="n">multiply</span> \
    <span class="o">|</span> <span class="n">write</span> <span class="o">|</span> <span class="n">read</span> <span class="o">|</span> <span class="n">flatten</span> \
    <span class="o">|</span> <span class="n">map_</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span> \
    <span class="o">|</span> <span class="n">view</span>

<span class="n">config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;cpu&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">Task</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;executor&#39;</span><span class="p">:</span> <span class="s1">&#39;ray&#39;</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="c1"># set input</span>
<span class="n">num_ch</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="c1"># resolve dependencies</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">my_flow</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num_ch</span><span class="p">)</span>
<span class="c1"># now can generate dag</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;quick_start_dag&#39;</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># try run the flow</span>
<span class="c1"># Note: this is specific for ipython environment, in normal cases, use `asyncio.run`</span>
<span class="k">await</span> <span class="n">flowsaber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>

<span class="c1"># visualize the flow</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;quick_start_dag.png&#39;</span><span class="p">)</span>
<span class="n">imgplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Config is: 
<span style="font-weight: bold">{</span>
    <span style="color: #008000; text-decoration-color: #008000">'_Context__flow_stack'</span>: <span style="font-weight: bold">[]</span>,
    <span style="color: #008000; text-decoration-color: #008000">'_Context__env_tasks'</span>: <span style="font-weight: bold">{}</span>,
    <span style="color: #008000; text-decoration-color: #008000">'_flow_stack'</span>: <span style="font-weight: bold">[]</span>,
    <span style="color: #008000; text-decoration-color: #008000">'cpu'</span>: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">8</span>,
    <span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">class</span><span style="color: #000000; text-decoration-color: #000000"> </span><span style="color: #008000; text-decoration-color: #008000">'flowsaber.core.task.Task'</span><span style="font-weight: bold">&gt;</span>: <span style="font-weight: bold">{</span><span style="color: #008000; text-decoration-color: #008000">'executor'</span>: <span style="color: #008000; text-decoration-color: #008000">'ray'</span><span style="font-weight: bold">}</span>
<span style="font-weight: bold">}</span>
</pre>
</div><script type="application/vnd.jupyter.widget-view+json">
{"version_major": 2, "version_minor": 0, "model_id": "3aee1469e0694cc2a20659d33202a8ab"}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25
4100
1300
4225
</pre></div>
</div>
<img alt="_images/quick_start_2_3.png" src="_images/quick_start_2_3.png" />
</div>
</div>
</div>
<div class="section" id="example-for-real-work">
<h2>Example for real work<a class="headerlink" href="#example-for-real-work" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>This is a rewrite version of <a class="reference external" href="https://snakemake.readthedocs.io/en/stable/tutorial/short.html">snakemake tutorial</a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flowsaber</span>
<span class="kn">from</span> <span class="nn">flowsaber</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># EnvTask is the real dependent task when using conda/image option</span>
<span class="n">EnvTask</span><span class="o">.</span><span class="n">DEFAULT_CONFIG</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task_workdir&#39;</span><span class="p">:</span> <span class="s1">&#39;/tmp/Env&#39;</span><span class="p">}</span>  <span class="c1"># make the EnvTask cache at a global place</span>

<span class="nd">@shell</span><span class="p">(</span><span class="n">conda</span><span class="o">=</span><span class="s2">&quot;bwa=0.7.17 samtools=1.9&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bwa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fa</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">fastq</span><span class="p">:</span> <span class="n">File</span><span class="p">):</span>  <span class="c1"># input will be automatically converted if has type annotation</span>
    <span class="sd">&quot;&quot;&quot;bwa mem -t {self.cpu} {fa} {fastq} | samtools view -Sb - &gt; {fastq.stem}.bam&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;*.bam&quot;</span>  <span class="c1"># for ShellTask, str variable in the return will be treated as File and globed</span>

<span class="nd">@shell</span><span class="p">(</span><span class="n">conda</span><span class="o">=</span><span class="s2">&quot;bwa=0.7.17 samtools=1.9&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="n">bam</span><span class="p">:</span> <span class="n">File</span><span class="p">):</span>  <span class="c1"># self is optional in case you don&#39;t want to access the current task</span>
    <span class="sd">&quot;&quot;&quot;samtools sort -o {sorted_bam} {bam}&quot;&quot;&quot;</span>  <span class="c1"># use local variable</span>
    <span class="n">sorted_bam</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bam</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.sorted.bam&quot;</span>
    <span class="k">return</span> <span class="n">sorted_bam</span>

<span class="nd">@shell</span><span class="p">(</span><span class="n">conda</span><span class="o">=</span><span class="s2">&quot;bcftools=1.9 samtools=1.9&quot;</span><span class="p">,</span> <span class="n">pubdir</span><span class="o">=</span><span class="s2">&quot;results/vcf&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">fa</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">bams</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># In case you need to write some python codes</span>
    <span class="n">bams</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bam</span><span class="p">)</span> <span class="k">for</span> <span class="n">bam</span> <span class="ow">in</span> <span class="n">bams</span><span class="p">)</span>
    <span class="n">Shell</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;samtools mpileup -g -f </span><span class="si">{</span><span class="n">fa</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bams</span><span class="si">}</span><span class="s2"> | bcftools call -mv - &gt; all.vcf&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;all.vcf&quot;</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">pubdir</span><span class="o">=</span><span class="s2">&quot;results/stats&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="n">vcf</span><span class="p">:</span> <span class="n">File</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">pysam</span> <span class="kn">import</span> <span class="n">VariantFile</span>

    <span class="n">quals</span> <span class="o">=</span> <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">qual</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">VariantFile</span><span class="p">(</span><span class="n">vcf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">))]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">quals</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;report.svg&quot;</span><span class="p">)</span>

<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">call_vcf_flow</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">fastq</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="n">bams</span><span class="p">):</span>  <span class="c1"># task is normal function, use python as wish</span>
        <span class="k">return</span> <span class="n">call</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">bams</span><span class="p">)</span>

    <span class="n">bam1</span> <span class="o">=</span> <span class="n">bwa</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">fastq</span><span class="p">)</span>  <span class="c1"># automatically clone channel</span>
    <span class="n">bam2</span> <span class="o">=</span> <span class="n">bwa</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">fastq</span><span class="p">)</span>
    <span class="n">mix</span><span class="p">(</span><span class="n">bam1</span><span class="p">,</span> <span class="n">bam2</span><span class="p">)</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">|</span> <span class="n">collect</span> <span class="o">|</span> <span class="n">_call</span> <span class="o">|</span> <span class="n">stats</span>

<span class="n">config_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;cpu&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">Task</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;executor&#39;</span><span class="p">:</span> <span class="s1">&#39;process&#39;</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;../../tests/snamke-demo.nosync/data&#39;</span>
<span class="n">fa</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">/genome.fa&#39;</span><span class="p">)</span>
<span class="n">fastq</span> <span class="o">=</span> <span class="n">Channel</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">/samples/</span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A.fastq&#39;</span><span class="p">,</span> <span class="s1">&#39;B.fastq&#39;</span><span class="p">,</span> <span class="s1">&#39;C.fastq&#39;</span><span class="p">]])</span>

<span class="c1"># resolve dependency</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">call_vcf_flow</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="n">fastq</span><span class="p">)</span>
<span class="c1"># generate dag</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;snakemake_dag&#39;</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># run the flow</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">flowsaber</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">workflow</span><span class="p">))</span>

</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="task.html" class="btn btn-neutral float-right" title="Task" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to flowsaber’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, bakezq

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>