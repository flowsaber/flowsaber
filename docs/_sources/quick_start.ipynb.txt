{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "collapsed": true,
    "pycharm": {
     "name": "#%% md\n"
    }
   },
   "source": [
    "# Quick Start"
   ]
  },
  {
   "cell_type": "markdown",
   "source": [
    "### Installation\n",
    "\n",
    "- Install from PYPI or from source.\n",
    "\n",
    "```\n",
    "pip install flowsaber\n",
    "```\n",
    "\n",
    "Or\n",
    "\n",
    "```bash\n",
    "https://github.com/zhqu1148980644/flowsaber.git\n",
    "cd flowsaber && pip install .\n",
    "```\n",
    "\n",
    "### Main concepts\n",
    "\n",
    "For users who are familiar with nextflow usages can skip this part, other's can also check\n",
    "[this](https://www.nextflow.io/docs/edge/basic.html) for similar descriptions that comes from the introduction\n",
    "section of the nextflow documentation.\n",
    "\n",
    "Basically there are several components that are exposed to users for building and configuring workflows.\n",
    "\n",
    "##### Task\n",
    "`Task` is the object represents the execution unit in your workflow. Tasks runs in parallel for different inputs.\n",
    "\n",
    "##### Flow\n",
    "`Flow` is the object that combines and records dependencies of all tasks you have put in. After it's been\n",
    "instantiated, it should be called for the actual dependency building and then can be executed by call `flow.execute()`.\n",
    "\n",
    "##### Channel\n",
    "`Channel` represents a flow/queue of data, it's consumed by Tasks. Any user defined data should be\n",
    "enqueued into a channel and then as arguments of Task/Flow.\n",
    "\n",
    "##### Operator\n",
    "`Operator` is built-in tasks that helps to manipulate the control of channels.\n",
    "\n",
    "- For example: `map, sum, count, collect, flatten....`\n",
    "\n",
    "### A Typical workflow\n",
    "\n",
    "The workflow defined below covers most sets of features supported by pyflow.\n",
    "\n",
    "- Note: the output of the workflow may be different in different runs, this is\n",
    "due to the parallelism of task's executions for different inputs."
   ],
   "metadata": {
    "collapsed": false,
    "pycharm": {
     "name": "#%% md\n"
    }
   }
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "outputs": [
    {
     "data": {
      "text/plain": "<rich.jupyter.JupyterRenderable at 0x7faa09c6cd60>",
      "text/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">Config is: \n<span style=\"font-weight: bold\">{</span>\n    <span style=\"color: #008000; text-decoration-color: #008000\">'_Context__flow_stack'</span>: <span style=\"font-weight: bold\">[]</span>,\n    <span style=\"color: #008000; text-decoration-color: #008000\">'_Context__env_tasks'</span>: <span style=\"font-weight: bold\">{}</span>,\n    <span style=\"color: #008000; text-decoration-color: #008000\">'_flow_stack'</span>: <span style=\"font-weight: bold\">[]</span>,\n    <span style=\"color: #008000; text-decoration-color: #008000\">'cpu'</span>: <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">8</span>,\n    <span style=\"font-weight: bold\">&lt;</span><span style=\"color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold\">class</span><span style=\"color: #000000; text-decoration-color: #000000\"> </span><span style=\"color: #008000; text-decoration-color: #008000\">'flowsaber.core.task.Task'</span><span style=\"font-weight: bold\">&gt;</span>: <span style=\"font-weight: bold\">{</span><span style=\"color: #008000; text-decoration-color: #008000\">'executor'</span>: <span style=\"color: #008000; text-decoration-color: #008000\">'ray'</span><span style=\"font-weight: bold\">}</span>\n<span style=\"font-weight: bold\">}</span>\n</pre>\n"
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/plain": "Output()",
      "application/vnd.jupyter.widget-view+json": {
       "version_major": 2,
       "version_minor": 0,
       "model_id": "3aee1469e0694cc2a20659d33202a8ab"
      }
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "25\n",
      "4100\n",
      "1300\n",
      "4225\n"
     ]
    },
    {
     "data": {
      "text/plain": "<Figure size 432x288 with 1 Axes>",
      "image/png": "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\n"
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "import sys\n",
    "\n",
    "import matplotlib.image as mpimg\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "sys.path.insert(0, '../../')\n",
    "import flowsaber\n",
    "from flowsaber import *\n",
    "\n",
    "EnvTask.DEFAULT_CONFIG = {'task_workdir': '/tmp/Env'}  # make the EnvTask cache at a global place\n",
    "\n",
    "@task\n",
    "def add(self, num):  # self is optional\n",
    "    return num + 1\n",
    "\n",
    "@task\n",
    "def multiply(num1, num2):\n",
    "    return num1 * num2\n",
    "\n",
    "@shell\n",
    "def write(num):\n",
    "    \"\"\"echo {num} > 1.txt\"\"\"\n",
    "    return '*.txt'\n",
    "\n",
    "@task\n",
    "def read(f: File):\n",
    "    return open(str(f)).readlines()\n",
    "\n",
    "@flow\n",
    "def sub_flow(num):\n",
    "    return add(num) | map_(lambda x: x ** 2) | add\n",
    "\n",
    "@flow\n",
    "def my_flow(num):\n",
    "    [sub_flow(num), sub_flow(num)] | multiply \\\n",
    "    | write | read | flatten \\\n",
    "    | map_(lambda x: int(x.strip())) \\\n",
    "    | view\n",
    "\n",
    "config_dict.update({\n",
    "    'cpu': 8,\n",
    "    Task: {\n",
    "        'executor': 'ray'\n",
    "    }\n",
    "})\n",
    "\n",
    "# set input\n",
    "num_ch = Channel.values(1, 2, 3, 4, 5, 6, 7, 8)\n",
    "# resolve dependencies\n",
    "workflow = my_flow(num=num_ch)\n",
    "# now can generate dag\n",
    "workflow.graph.render('quick_start_dag', view=False, format='png', cleanup=True)\n",
    "# try run the flow\n",
    "# Note: this is specific for ipython environment, in normal cases, use `asyncio.run`\n",
    "await flowsaber.run(workflow)\n",
    "\n",
    "# visualize the flow\n",
    "img = mpimg.imread('quick_start_dag.png')\n",
    "imgplot = plt.imshow(img)\n",
    "plt.show(block=False)"
   ],
   "metadata": {
    "collapsed": false,
    "pycharm": {
     "name": "#%%\n"
    }
   }
  },
  {
   "cell_type": "markdown",
   "source": [
    "### Example for real work\n",
    "\n",
    "- This is a rewrite version of [snakemake tutorial](https://snakemake.readthedocs.io/en/stable/tutorial/short.html)\n",
    "\n",
    "```python\n",
    "import flowsaber\n",
    "from flowsaber import *\n",
    "\n",
    "\n",
    "# EnvTask is the real dependent task when using conda/image option\n",
    "EnvTask.DEFAULT_CONFIG = {'task_workdir': '/tmp/Env'}  # make the EnvTask cache at a global place\n",
    "\n",
    "@shell(conda=\"bwa=0.7.17 samtools=1.9\")\n",
    "def bwa(self, fa: File, fastq: File):  # input will be automatically converted if has type annotation\n",
    "    \"\"\"bwa mem -t {self.cpu} {fa} {fastq} | samtools view -Sb - > {fastq.stem}.bam\"\"\"\n",
    "    return \"*.bam\"  # for ShellTask, str variable in the return will be treated as File and globed\n",
    "\n",
    "@shell(conda=\"bwa=0.7.17 samtools=1.9\")\n",
    "def sort(bam: File):  # self is optional in case you don't want to access the current task\n",
    "    \"\"\"samtools sort -o {sorted_bam} {bam}\"\"\"  # use local variable\n",
    "    sorted_bam = f\"{bam.stem}.sorted.bam\"\n",
    "    return sorted_bam\n",
    "\n",
    "@shell(conda=\"bcftools=1.9 samtools=1.9\", pubdir=\"results/vcf\")\n",
    "def call(fa: File, bams: list):  # In case you need to write some python codes\n",
    "    bams = ' '.join(str(bam) for bam in bams)\n",
    "    Shell(f\"samtools mpileup -g -f {fa} {bams} | bcftools call -mv - > all.vcf\")\n",
    "    return \"all.vcf\"\n",
    "\n",
    "@task(pubdir=\"results/stats\")\n",
    "def stats(vcf: File):\n",
    "    import matplotlib\n",
    "    matplotlib.use(\"Agg\")\n",
    "    import matplotlib.pyplot as plt\n",
    "    from pysam import VariantFile\n",
    "\n",
    "    quals = [record.qual for record in VariantFile(vcf.open('rb'))]\n",
    "    plt.hist(quals)\n",
    "\n",
    "    plt.savefig(\"report.svg\")\n",
    "\n",
    "@flow\n",
    "def call_vcf_flow(fa, fastq):\n",
    "    def _call(bams):  # task is normal function, use python as wish\n",
    "        return call(fa, bams)\n",
    "\n",
    "    bam1 = bwa(fa, fastq)  # automatically clone channel\n",
    "    bam2 = bwa(fa, fastq)\n",
    "    mix(bam1, bam2) | sort | collect | _call | stats\n",
    "\n",
    "config_dict.update({\n",
    "    'cpu': 8,\n",
    "    'memory': 20,\n",
    "    Task: {\n",
    "        'executor': 'process'\n",
    "    }\n",
    "})\n",
    "\n",
    "prefix = '../../tests/snamke-demo.nosync/data'\n",
    "fa = Channel.value(f'{prefix}/genome.fa')\n",
    "fastq = Channel.values(*[f'{prefix}/samples/{sample}' for sample in ['A.fastq', 'B.fastq', 'C.fastq']])\n",
    "\n",
    "# resolve dependency\n",
    "workflow = call_vcf_flow(fa, fastq)\n",
    "# generate dag\n",
    "workflow.graph.render('snakemake_dag', view=False, format='png', cleanup=True)\n",
    "# run the flow\n",
    "asyncio.run(flowsaber.run(workflow))\n",
    "\n",
    "```"
   ],
   "metadata": {
    "collapsed": false,
    "pycharm": {
     "name": "#%% md\n"
    }
   }
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}